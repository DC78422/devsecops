include:
  - local: 'functions.gitlab-ci.yml'

variables:
  SBOM_PATH: "reports/cdx-sbom.json"

Forming CycloneDX SBOM:
  extends:
    - ".artifacts"
    - ".audit_base"
    - ".audit_rule"
  variables:
    AUDIT_IMAGE: "cyclonedx-gomod:1.7.0"
    AUDIT_IMAGE_ENTRYPOINT: ""
  before_script:
    - mkdir reports/ || true
  script:
    - /usr/bin/cyclonedx-gomod mod -json -output reports/cdx-sbom.json -assert-licenses -licenses .
  artifacts:
    paths:
      - reports/
    expire_in: 1 day

DefectDojo Engagement Creation:
  extends:
    - ".DefectDojo_Engagement_Creation"

Uploading SBOM to Dependency Track:
  extends:
    - ".Uploading_SBOM_to_Dependency_Track"
    - ".audit_rule"
  needs: ["Forming CycloneDX SBOM"]
